* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: #1a1a1a;
  color: #fff;
}
h1 { margin-bottom: 20px; }
/* Sticky header for controls */
.sticky-header {
  position: sticky;
  top: 0;
  z-index: 200;
  background: #1a1a1a;
  margin: 0 -20px;
  padding: 12px 20px 8px;
}
/* App layout */
.app-layout {
  display: flex;
  min-height: 100vh;
}
.nav-panel {
  width: 240px;
  flex-shrink: 0;
  background: #141414;
  border-right: 1px solid #333;
  position: sticky;
  top: 0;
  height: 100vh;
  overflow-y: auto;
}
.nav-header {
  padding: 16px 14px 12px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: #666;
  border-bottom: 1px solid #333;
}
.nav-list {
  list-style: none;
}
.nav-item {
  padding: 10px 14px;
  cursor: pointer;
  border-bottom: 1px solid #222;
}
.nav-item:hover { background: #1f1f1f; }
.nav-item.active { background: #252540; border-left: 3px solid #668; }
.nav-item.dimmed { opacity: 0.4; }
.nav-source-name {
  display: block;
  font-size: 13px;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.nav-meta {
  display: block;
  font-size: 11px;
  color: #666;
  margin-top: 3px;
}
.nav-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 3px;
  margin-top: 6px;
}
.nav-tags:empty { display: none; }
.nav-tags .tag, .nav-tags .year-badge {
  font-size: 10px;
  padding: 1px 6px;
}
.main-content {
  flex: 1;
  padding: 20px;
  min-width: 0;
}
.controls {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}
.search-box {
  flex: 1;
  min-width: 200px;
  padding: 10px 14px;
  font-size: 14px;
  border: 1px solid #444;
  border-radius: 6px;
  background: #2a2a2a;
  color: #fff;
}
.search-box:focus { outline: none; border-color: #666; }
.btn {
  padding: 10px 16px;
  font-size: 14px;
  border: 1px solid #444;
  border-radius: 6px;
  background: #2a2a2a;
  color: #fff;
  cursor: pointer;
}
.btn:hover { background: #3a3a3a; }
.tag-filters {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 16px;
}
.tag-filters:empty { display: none; }
.filter-tag {
  padding: 4px 10px;
  font-size: 12px;
  background: #333;
  border: 1px solid #444;
  border-radius: 14px;
  color: #aaa;
  cursor: pointer;
}
.filter-tag:hover { background: #444; color: #fff; }
.filter-tag.active {
  background: #446;
  border-color: #668;
  color: #fff;
}
/* Hidden toggle button */
.hidden-toggle {
  background: #2a2a2a;
}
.hidden-toggle.active {
  background: #446;
  border-color: #668;
}
/* Hidden tags in filter list */
.filter-tag.hidden-tag {
  background: #3a2a2a;
  border-color: #544;
}
.source-group { margin-bottom: 24px; }
.source-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  background: #333;
  border-radius: 8px;
  cursor: pointer;
  margin-bottom: 12px;
  position: sticky;
  top: var(--sticky-header-height, 60px);
  z-index: 100;
}
.source-header:hover { background: #3a3a3a; }
.source-header h2 {
  font-size: 16px;
  font-weight: 500;
}
.source-header .clip-count {
  font-size: 12px;
  color: #888;
}
.source-tags-year {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  align-items: center;
  flex: 1;
}
.source-header .toggle-icon {
  font-size: 12px;
  color: #888;
  transition: transform 0.2s;
}
.source-group.collapsed .toggle-icon { transform: rotate(-90deg); }
.source-group.collapsed .gallery,
.source-group.collapsed .clip-group { display: none; }
/* Clip groups */
.clip-group {
  margin: 12px 0;
  border: 2px solid #444;
  border-radius: 8px;
  padding: 8px;
  background: rgba(60, 60, 80, 0.2);
}
.clip-group-header {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px;
  margin: -8px -8px 8px;
  cursor: pointer;
  position: sticky;
  top: var(--sticky-header-plus-source, 108px);
  z-index: 50;
  background: #3a3a50;
  border-radius: 6px 6px 0 0;
}
.clip-group-header .toggle-icon {
  font-size: 12px;
  color: #888;
  transition: transform 0.2s;
}
.clip-group.collapsed .toggle-icon { transform: rotate(-90deg); }
.clip-group.collapsed .gallery { display: none; }
.clip-group.hidden { display: none; }
.clip-group-header .group-name {
  font-size: 14px;
  font-weight: 500;
}
.clip-group-header .group-tags-year {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  align-items: center;
  flex: 1;
}
.clip-group-header .group-actions {
  display: flex;
  gap: 6px;
  align-items: center;
}
.edit-range-btn, .delete-group-btn {
  display: none;
  font-size: 11px;
  color: #666;
  cursor: pointer;
  padding: 2px 6px;
}
.edit-range-btn:hover { color: #aaa; }
.delete-group-btn:hover { color: #f88; }
body.api-available .clip-group-header:hover .edit-range-btn,
body.api-available .clip-group-header:hover .delete-group-btn { display: inline; }
/* Group creation mode */
body.group-mode .video-card { cursor: crosshair; }
body.group-mode .video-card:hover { outline: 2px dashed #88f; }
.video-card.group-start { outline: 2px solid #8f8 !important; }
.video-card.group-pending { outline: 2px dashed #ff8 !important; }
/* Tag paint mode */
.tag-mode-toggle { display: none; }
body.api-available .tag-mode-toggle { display: inline-block; }
.tag-mode-toggle.active { background: #446; border-color: #668; }
.tag-mode-toolbar {
  display: none;
  gap: 8px;
  align-items: center;
  margin-bottom: 16px;
  padding: 10px 12px;
  background: #2a2a2a;
  border: 1px solid #444;
  border-radius: 6px;
}
body.api-available .tag-mode-toolbar:not(.collapsed) { display: flex; }
.tag-mode-input {
  width: 140px;
  padding: 8px 10px;
  font-size: 13px;
  border: 1px solid #444;
  border-radius: 4px;
  background: #1a1a1a;
  color: #fff;
}
.tag-mode-input:focus { outline: none; border-color: #666; }
.tag-mode-conf, .tag-mode-action {
  display: flex;
  gap: 2px;
}
.tag-mode-conf .conf-btn, .tag-mode-action .action-btn {
  padding: 6px 10px;
  font-size: 12px;
  border: 1px solid #444;
  background: #333;
  color: #888;
  cursor: pointer;
}
.tag-mode-conf .conf-btn:first-child, .tag-mode-action .action-btn:first-child { border-radius: 4px 0 0 4px; }
.tag-mode-conf .conf-btn:last-child, .tag-mode-action .action-btn:last-child { border-radius: 0 4px 4px 0; }
.tag-mode-conf .conf-btn:hover, .tag-mode-action .action-btn:hover { background: #444; color: #aaa; }
.tag-mode-conf .conf-btn.active { background: #446; border-color: #668; color: #fff; }
.tag-mode-action .action-btn.active[data-action="add"] { background: #363; border-color: #484; color: #8f8; }
.tag-mode-action .action-btn.active[data-action="remove"] { background: #633; border-color: #844; color: #f88; }
.tag-mode-start { margin-left: auto; }
body.tag-mode .tag-mode-toolbar { border-color: #668; background: #252540; }
body.tag-mode .tag-mode-start { background: #446; border-color: #668; }
body.tag-mode.tag-action-add .video-card { cursor: pointer; }
body.tag-mode.tag-action-add .video-card:hover { outline: 2px solid #8f8; }
body.tag-mode.tag-action-remove .video-card { cursor: pointer; }
body.tag-mode.tag-action-remove .video-card:hover { outline: 2px solid #f88; }
.start-group-btn {
  display: none;
  font-size: 11px;
  color: #666;
  cursor: pointer;
  margin-left: 8px;
}
.start-group-btn:hover { color: #aaa; }
body.api-available .source-header:hover .start-group-btn { display: inline; }
.gallery {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
  gap: 16px;
}
.video-card {
  background: #2a2a2a;
  border-radius: 8px;
  overflow: hidden;
}
.video-card.hidden { display: none; }
.source-group.hidden { display: none; }
.thumb-grid {
  cursor: pointer;
}
.thumb-grid img {
  width: 100%;
  display: block;
  background: #333;
  aspect-ratio: 16 / 9;
  border: none;
  object-fit: cover;
}
.thumb-grid img.lazy {
  background: linear-gradient(135deg, #2a2a2a 0%, #383838 50%, #2a2a2a 100%);
}
.video-info { padding: 10px; }
.video-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.video-name {
  font-size: 14px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.video-duration {
  font-size: 12px;
  color: #888;
}
.transcript-toggle {
  font-size: 12px;
  color: #888;
  cursor: pointer;
  margin-top: 8px;
}
.transcript-toggle:hover { color: #aaa; }
.transcript {
  display: none;
  margin-top: 8px;
  padding: 8px;
  background: #222;
  border-radius: 4px;
  font-size: 12px;
  line-height: 1.5;
  max-height: 200px;
  overflow-y: auto;
  white-space: pre-wrap;
}
.transcript.expanded { display: block; }
.transcript mark {
  background: #665500;
  color: #fff;
}
.tags-year {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  align-items: center;
  flex: 1;
  margin-left: 8px;
}
.tag, .year-badge {
  display: inline-flex;
  align-items: center;
  gap: 3px;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 11px;
  background: #555;
}
.tag::before, .year-badge::before {
  font-size: 8px;
}
.year-badge { border-radius: 4px; }
/* High confidence: fully visible */
.confidence-high { opacity: 1; }
/* Medium confidence: slightly faded with ? */
.confidence-medium { opacity: 0.75; }
.confidence-medium::after { content: "?"; margin-left: 2px; opacity: 0.7; }
/* Low confidence: faded with ?? */
.confidence-low { opacity: 0.55; }
.confidence-low::after { content: "??"; margin-left: 2px; opacity: 0.7; }
/* Inherited: italic */
.tag.inherited, .year-badge.inherited { font-style: italic; opacity: 0.5; }
/* Inline editing */
.tag.editable, .year-badge.editable { cursor: pointer; }
.tag.editable:hover, .year-badge.editable:hover { filter: brightness(1.2); }
.add-btn {
  display: none;
  padding: 2px 4px;
  font-size: 11px;
  background: none;
  border: none;
  color: #666;
  cursor: pointer;
}
.add-btn:hover { color: #aaa; }
body.api-available .video-card:hover .add-btn,
body.api-available .source-header:hover .add-btn,
body.api-available .clip-group-header:hover .add-btn { display: inline-block; }
.source-description, .group-description {
  font-size: 13px;
  color: #aaa;
  white-space: pre-wrap;
}
.source-description { margin-top: 8px; padding: 0 12px 12px; }
.group-description { padding: 0 8px 8px; }
.source-description:empty, .group-description:empty { display: none; }
.source-description.editing, .group-description.editing { display: block; }
.source-description textarea, .group-description textarea {
  width: 100%;
  min-height: 60px;
  padding: 8px;
  font-size: 13px;
  border: 1px solid #444;
  border-radius: 4px;
  background: #2a2a2a;
  color: #fff;
  resize: vertical;
}
.add-desc-btn {
  display: none;
  font-size: 11px;
  color: #666;
  cursor: pointer;
  margin-left: 8px;
}
.add-desc-btn:hover { color: #aaa; }
body.api-available .source-header:hover .add-desc-btn,
body.api-available .clip-group-header:hover .add-desc-btn { display: inline; }
.inline-popup {
  display: none;
  position: fixed;
  background: #333;
  border: 1px solid #555;
  border-radius: 6px;
  padding: 8px;
  z-index: 1001;
  box-shadow: 0 4px 12px rgba(0,0,0,0.5);
}
.inline-popup.active { display: block; }
.inline-popup input, .inline-popup select {
  padding: 6px 8px;
  font-size: 13px;
  border: 1px solid #444;
  border-radius: 4px;
  background: #2a2a2a;
  color: #fff;
}
.inline-popup input { width: 120px; }
.inline-popup input.year-input { width: 70px; }
.inline-popup .popup-row {
  display: flex;
  gap: 6px;
  align-items: center;
  margin-bottom: 6px;
}
.inline-popup .popup-row:last-child { margin-bottom: 0; }
.inline-popup .conf-label {
  font-size: 10px;
  color: #888;
  margin-right: 4px;
}
.inline-popup .conf-btn {
  padding: 4px 8px;
  font-size: 11px;
  border: 1px solid #555;
  border-radius: 4px;
  background: #444;
  color: #ccc;
  cursor: pointer;
}
.inline-popup .conf-btn:hover { background: #555; }
.inline-popup .conf-btn.active { background: #666; border-color: #888; color: #fff; }
.inline-popup .delete-btn {
  padding: 4px 8px;
  font-size: 11px;
  border: none;
  border-radius: 4px;
  background: #633;
  color: #faa;
  cursor: pointer;
}
.inline-popup .delete-btn:hover { background: #844; }
.modal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.9);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}
.modal.active { display: flex; flex-direction: column; }
.modal video {
  max-width: 90%;
  max-height: 85vh;
}
.modal-info {
  color: white;
  text-align: center;
  margin-bottom: 8px;
  max-width: 90%;
}
.modal-info .clip-name { font-weight: bold; }
.modal-info .clip-tags { opacity: 0.8; font-size: 0.9em; }
.modal-close {
  position: absolute;
  top: 20px;
  right: 30px;
  font-size: 40px;
  color: #fff;
  cursor: pointer;
}
